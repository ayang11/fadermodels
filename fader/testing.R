rm(list=ls())
library(gsl)

setwd('C:\\Users\\Andrew\\Desktop\\Workspace\\models\\fader')

data.conint=read.csv('raw//pnbd.csv')
data.disint=read.csv('raw//bgbb.csv')
data.count=read.csv('raw//count.csv')
data.contime=read.csv('raw//contime.csv')
data.distime=read.csv('raw//distime.csv')
data.choice=read.csv('raw//choice.csv')
data.dir=read.csv('raw//dirich.csv')

standardtest=function(data,model,nseg=1,...){
	print('Model')
	mod=fm(data,model,nseg,...)
	print(mod)
	print('Prediction/RMSE')
	print(rmse(mod))
	barplot(mod)
	print('Mean/Var')
	print(mean(mod))
	print(vcov(mod))
	print(chitest(mod))
	Sys.sleep(1)
	print(post(mod))
	paramplot(mod)
	return(mod)
}

tmp=standardtest(data.count,'pois',nseg=1)
test=standardtest(data.count,'nbd',nseg=1,spike=T)
standardtest(data.contime,'exp',pop=1499)
standardtest(data.contime,'eg',pop=1499)
standardtest(data.contime,'wg',pop=1499)
standardtest(data.contime,'gg',pop=1499)
standardtest(data.distime,'geom',pop=1000)
standardtest(data.distime,'bg',pop=1000)
standardtest(data.distime,'dw',pop=1000)
standardtest(data.distime,'bdw',pop=1000)
standardtest(data.choice,'bb')
standardtest(data.dir,'dir')
#
#standardtest(data.conint,'pexp')
#standardtest(data.conint,'pnbd')
#standardtest(data.disint,'bgbb')
#standardtest(data.conint,'bgnbd')
#
a=fm(data.conint,'pexp',1)
b=fm(data.conint,'pexp',2)
c=fm(data.conint,'bgnbd',1)
d=fm(data.conint,'bgnbd',2)
e=fm(data.conint,'pnbd',1)
f=fm(data.conint,'pnbd',2)
g=fm(data.disint,'bgbb',1)
h=fm(data.disint,'bgbb',2,tries=10)

par(mfrow=c(2,4))
c1=cumtracking(a)
c2=cumtracking(b)
c3=cumtracking(c)
c4=cumtracking(d)
c5=cumtracking(e)
c6=cumtracking(f)
c7=cumtracking(g)
c8=cumtracking(h)
plot(c1)
plot(c2)
plot(c3)
plot(c4)
plot(c5)
plot(c6)
plot(c7)
plot(c8)
plot(diff(c1))
plot(diff(c2))
plot(diff(c3))
plot(diff(c4))
plot(diff(c5))
plot(diff(c6))
plot(diff(c7))
plot(diff(c8))


#dir=standardtest('dirich.csv','dir',2)
#dir=update(dir,x1=.195,x2=.054,x3=0.06,x4=0.116,x5=.362,x6=.139,x7=.151,x8=.175)
#predict(dir)
#mean(dir)
#pen.dir(dir)
#loyal.dir(dir)
#once.dir(dir)
#mkt.dir(dir)
#scr.dir(dir)
#post(dir)